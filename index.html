<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Assembly</title>
  </head>
  <body>

    <script src="libwabt.js"></script>
	<script>

        WabtModule().then((wabt) => {

            const watStr = `(module
                (func (export "addTwo") (param i32 i32) (result i32)
                    local.get 0
                    local.get 1
                    i32.add
                )
            )`;

            const module = wabt.parseWat('test.wast', watStr);

            const binaryBuffer = module.toBinary({}).buffer;

            const wasmModule = new WebAssembly.Module(binaryBuffer);

            const wasmInstance = new WebAssembly.Instance(wasmModule, {});

            const { addTwo } = wasmInstance.exports;

            for (let i = 0; i < 10; i++) {
                console.log(addTwo(i, i));
            }

        });

    </script>
  </body>
</html>